# Covia Docusaurus MiniSearch Plugin

Covia MiniSearch Plugin æ˜¯ä¸€å€‹ç‚º Docusaurus å°å‹è‡³ä¸­å‹çŸ¥è­˜åº«ç¶²ç«™è¨­è¨ˆçš„è¼•é‡å‹æœ¬åœ°æœå°‹è§£æ±ºæ–¹æ¡ˆã€‚  
å®ƒä¸»æ‰“å¿«é€Ÿéƒ¨ç½²ã€ç°¡å–®æ•´åˆï¼Œç‰¹åˆ¥é©åˆä¸å…·å‚™å°ˆæ¥­é–‹ç™¼èƒŒæ™¯çš„ä½¿ç”¨è€…ã€‚  
æ­¤æ’ä»¶å®Œå…¨æ–¼å‰ç«¯é‹è¡Œï¼Œç„¡éœ€é¡å¤–çš„å¾Œç«¯ä¼ºæœå™¨æ”¯æŒï¼Œé©åˆå€‹äººã€åœ˜éšŠèˆ‡ä¸­å°å‹å°ˆæ¡ˆä½¿ç”¨ã€‚

> ğŸ“¢ **æ³¨æ„**ï¼šæœ¬æ’ä»¶ä¸¦ä¸é©ç”¨æ–¼è¶…å¤§å‹ã€å¤šèªç³»ç¶²ç«™ï¼Œæˆ–éœ€è¦ä¸­æ–‡åˆ†è©å„ªåŒ–çš„å ´æ™¯ã€‚
> è‹¥æœ‰é€²éšéœ€æ±‚ï¼Œå»ºè­°åƒè€ƒå¦‚ @easyops-cn/docusaurus-search-local ç­‰å…¶ä»–è§£æ±ºæ–¹æ¡ˆã€‚

## æª”æ¡ˆçµæ§‹

```
my-website/
â”‚
â”œâ”€â”€ plugins/
â”‚   â”‚
â”‚   â””â”€â”€ docusaurus-plugin-minisearch/
â”‚       â”‚
â”‚       â”œâ”€â”€ index.js
â”‚       â”œâ”€â”€ indexGenerator.js
â”‚       â”œâ”€â”€ SearchBar.js
â”‚       â”œâ”€â”€ SearchResults.js
â”‚       â”œâ”€â”€ styles.module.css
â”‚       â”œâ”€â”€ README.md
â”‚       â””â”€â”€ LICENSE
```

## åŠŸèƒ½ç‰¹é»

* **å³æ™‚æœå°‹**ï¼šæä¾›é«˜æ•ˆã€å³æ™‚çš„å‰ç«¯æœå°‹é«”é©—
* **é—œéµå­—é«˜äº®**ï¼šåœ¨æœå°‹çµæœä¸­é«˜äº®é¡¯ç¤ºåŒ¹é…çš„é—œéµå­—
* **æ¨¡ç³Šæœå°‹**ï¼šæ”¯æ´æ‹¼å¯«éŒ¯èª¤å’Œè¿‘ä¼¼åŒ¹é…
* **å‰ç¶´æœå°‹**ï¼šæ”¯æ´è¼¸å…¥éƒ¨åˆ†è©èªé€²è¡ŒåŒ¹é…
* **å­—æ®µåŠ æ¬Š**ï¼šå¯å°ä¸åŒå­—æ®µï¼ˆå¦‚æ¨™é¡Œï¼‰è¨­ç½®ä¸åŒçš„æ¬Šé‡
* **ç„¡ç¸«æ•´åˆ**ï¼šå®Œç¾èå…¥ Docusaurus ä¸»é¡Œï¼Œæ”¯æ´æ˜æš—æ¨¡å¼åˆ‡æ›
* **å®Œæ•´å¸ƒå±€**ï¼šæœå°‹çµæœé é¢åŒ…å«é é¦–å’Œé å°¾ï¼Œä¿æŒç¶²ç«™ä¸€è‡´æ€§
* **è‡ªå‹•ç´¢å¼•**ï¼šåœ¨å»ºç½®æ™‚è‡ªå‹•ç”Ÿæˆæœå°‹ç´¢å¼•

## å®‰è£æ–¹å¼

### å…ˆæ±ºæ¢ä»¶

* Docusaurus v3.0.0 æˆ–ä»¥ä¸Šç‰ˆæœ¬
* Node.js v16.0.0 æˆ–ä»¥ä¸Šç‰ˆæœ¬

### æ­¥é©Ÿ

**1. åœ¨ä½ çš„ Docusaurus é …ç›®ä¸­å®‰è£å¿…è¦ä¾è³´åŠæ’ä»¶ç›®éŒ„ï¼š**

* å¿…é ˆå®‰è£çš„å¿…è¦ä¾è³´ï¼š

| å¥—ä»¶ | èªªæ˜ | å®‰è£æŒ‡ä»¤ |
|---|----|-------|
| minisearch | å‰ç«¯å…¨æ–‡æœå°‹å¼•æ“ | npm install minisearch |
| globby | æª”æ¡ˆè·¯å¾‘æŠ“å–å·¥å…· | npm install globby |
| gray-matter | è§£æ .md / .mdx å‰ç½® metadata | npm install gray-matter |

```
npm install minisearch globby gray-matter
```
* å‰µå»ºæ’ä»¶ç›®éŒ„ï¼š
```bash
mkdir -p plugins/docusaurus-plugin-minisearch
```

**2. è¤‡è£½æ’ä»¶æª”æ¡ˆåˆ°è©²ç›®éŒ„ï¼š**

```bash
# è¤‡è£½ä»¥ä¸‹æª”æ¡ˆåˆ°æ’ä»¶ç›®éŒ„
# - index.js
# - indexGenerator.js
# - SearchBar.js
# - SearchResults.js
# - styles.module.css
```

**3. åœ¨ `docusaurus.config.js` ä¸­æ·»åŠ æ’ä»¶é…ç½®ï¼š**

```js
module.exports = {
  // å…¶ä»–é…ç½®...
  plugins: [
    [
      './plugins/docusaurus-plugin-minisearch',
      {
        // é…ç½®é¸é …
        highlightColor: '#ffeb3b',
        searchResultPath: '/search-results',
        searchFields: ['title', 'content'],
        resultFields: ['title', 'url', 'excerpt'],
        maxResults: 10
      }
    ],
  ],
};
```

## é…ç½®é¸é …

| é¸é … | é¡å‹ | é»˜èªå€¼ | èªªæ˜ |
|------|------|--------|------|
| highlightColor | String | '#ffeb3b' | æœå°‹é—œéµå­—é«˜äº®é¡è‰² |
| debounceTime | Number | 3000 | é€£çºŒæœå°‹çš„æœ€å°é–“éš”æ™‚é–“(æ¯«ç§’) |
| searchResultPath | String | '/search-results' | æœå°‹çµæœé¡¯ç¤ºé é¢è·¯å¾‘ |
| indexPath | String | '/search-index.json' | æœå°‹ç´¢å¼•æª”æ¡ˆè·¯å¾‘ |
| searchFields | Array | ['title', 'content'] | è¦æœå°‹çš„æ¬„ä½ |
| resultFields | Array | ['title', 'url', 'excerpt'] | è¦é¡¯ç¤ºçš„çµæœæ¬„ä½ |
| maxResults | Number | 10 | æœ€å¤§é¡¯ç¤ºçµæœæ•¸é‡ |

## æŠ€è¡“å¯¦ç¾

### æ’ä»¶æ¶æ§‹

æ’ä»¶ç”±ä»¥ä¸‹æ ¸å¿ƒçµ„ä»¶æ§‹æˆï¼š

1. **ç´¢å¼•ç”Ÿæˆå™¨** - å¾æ–‡æª”æª”æ¡ˆç”Ÿæˆæœå°‹ç´¢å¼•
2. **æœå°‹æ¡†çµ„ä»¶** - æ•´åˆåˆ° Docusaurus å°èˆªæ¬„
3. **æœå°‹çµæœé é¢** - é¡¯ç¤ºæœå°‹çµæœä¸¦é«˜äº®é—œéµå­—
4. **æ’ä»¶ä¸»æ–‡ä»¶** - é€£æ¥å„çµ„ä»¶ä¸¦è™•ç†é…ç½®

### ä½¿ç”¨çš„é—œéµæŠ€è¡“

* **MiniSearch** - è¼•é‡ç´šä½†åŠŸèƒ½å¼·å¤§çš„å‰ç«¯å…¨æ–‡æœå°‹å¼•æ“
* **Docusaurus Theme API** - é›†æˆåˆ° Docusaurus ä¸»é¡Œç³»çµ±
* **React Hooks** - ç®¡ç†æœå°‹ç‹€æ…‹å’Œç´¢å¼•è¼‰å…¥
* **Docusaurus Plugin API** - è¨»å†Šè·¯ç”±å’Œå…±äº«é…ç½®æ•¸æ“š

### å·¥ä½œåŸç†

1. **ç´¢å¼•ç”Ÿæˆ**
   * åœ¨å»ºç½®æ™‚éæ­·æ‰€æœ‰æ–‡æª”æª”æ¡ˆ
   * æå–æ¨™é¡Œã€å…§å®¹ã€URL ç­‰ä¿¡æ¯
   * ç”Ÿæˆ JSON ç´¢å¼•æª”æ¡ˆå­˜æ”¾åœ¨ `static` ç›®éŒ„
   
2. **æœå°‹æµç¨‹**
   * ç”¨æˆ¶åœ¨å°èˆªæ¬„æœå°‹æ¡†è¼¸å…¥é—œéµå­—
   * é»æ“Šæœå°‹æŒ‰éˆ•å¾Œå°èˆªè‡³æœå°‹çµæœé é¢
   * æœå°‹çµæœé é¢è¼‰å…¥ç´¢å¼•æª”æ¡ˆ
   * ä½¿ç”¨ MiniSearch åœ¨ç€è¦½å™¨ä¸­é€²è¡Œæœå°‹
   * æ¸²æŸ“æœå°‹çµæœä¸¦é«˜äº®é—œéµå­—

## è‡ªå®šç¾©

### è‡ªå®šç¾©æœå°‹çµæœæ¨£å¼

ä¿®æ”¹ `styles.module.css` æª”æ¡ˆå¯è‡ªå®šç¾©æœå°‹çµæœçš„å¤–è§€ï¼š

```css
/* ä¿®æ”¹æœå°‹çµæœé …ç›®æ¨£å¼ */
.resultItem {
  /* è‡ªå®šç¾©æ¨£å¼ */
}

/* ä¿®æ”¹é«˜äº®é—œéµå­—æ¨£å¼ */
.highlight {
  /* è‡ªå®šç¾©æ¨£å¼ */
}
```

### è‡ªå®šç¾©æœå°‹é¸é …

åœ¨ `SearchResults.js` ä¸­ä¿®æ”¹æœå°‹é¸é …ï¼š

```javascript
const hits = miniSearch.search(query, { 
  prefix: true,      // å‰ç¶´æœå°‹
  boost: { title: 2 }, // æ¨™é¡Œæ¬Šé‡ç‚º 2
  fuzzy: 0.2         // æ¨¡ç³Šæœå°‹ï¼Œå®¹è¨± 20% çš„ç·¨è¼¯è·é›¢
});
```

## å¸¸è¦‹å•é¡Œ

**Q: æœå°‹ç´¢å¼•æœƒå¢åŠ ç¶²ç«™å¤§å°å—ï¼Ÿ**  
A: æœƒï¼Œä½†å¹…åº¦æœ‰é™ã€‚å°æ–¼ä¸­å°å‹æ–‡æª”ç¶²ç«™ï¼Œç´¢å¼•é€šå¸¸åœ¨å¹¾ç™¾KBç¯„åœå…§ã€‚

**Q: å¦‚ä½•æ›´æ–°æœå°‹ç´¢å¼•ï¼Ÿ**  
A: æ¯æ¬¡é‡æ–°å»ºç½®ç¶²ç«™æ™‚æœƒè‡ªå‹•æ›´æ–°ç´¢å¼•ã€‚

**Q: æœå°‹çµæœæ˜¯å¦æ”¯æ´å¤šèªè¨€ï¼Ÿ**  
A: åŸºæœ¬æ”¯æ´ï¼Œä½†å¯èƒ½éœ€è¦é‡å°ä¸åŒèªè¨€èª¿æ•´åˆ†è©è¨­å®šã€‚

**Q: ç‚ºä»€éº¼æœå°‹çµæœé é¢é¡¯ç¤ºã€Œé é¢æœªæ‰¾åˆ°ã€ï¼Ÿ**  
A: é€™é€šå¸¸æ˜¯ç”±æ–¼è·¯ç”±è¡çªå°è‡´ã€‚ç¢ºä¿ `searchResultPath` è¨­ç½®ç‚ºä¸€å€‹ä¸èˆ‡å…¶ä»–è·¯ç”±è¡çªçš„å€¼ã€‚

## æŠ€è¡“é™åˆ¶

* ç´”å‰ç«¯æœå°‹ï¼Œä¸é©ç”¨æ–¼æ¥µå¤§å‹æ–‡æª”åº«
* æœå°‹ç´¢å¼•éœ€è¦åœ¨å»ºç½®æ™‚ç”Ÿæˆï¼Œç„¡æ³•åŒ…å«å‹•æ…‹å…§å®¹
* ç›®å‰æ²’æœ‰å…§ç½®çš„æœå°‹å»ºè­°åŠŸèƒ½

## è²¢ç»æŒ‡å—

æ­¡è¿æäº¤ Issues å’Œ Pull Requestsã€‚åœ¨æäº¤å‰ï¼Œè«‹ç¢ºä¿ï¼š

1. ä»£ç¢¼ç¬¦åˆå°ˆæ¡ˆçš„ç·¨ç¢¼é¢¨æ ¼
2. æ‰€æœ‰æ¸¬è©¦å‡å·²é€šé
3. æ–°åŠŸèƒ½æˆ–ä¿®æ”¹å·²æ·»åŠ é©ç•¶çš„æ–‡æª”

## å¯¦ä½œç´°ç¯€èˆ‡æ³¨æ„äº‹é …

### MiniSearch ä½¿ç”¨æ³¨æ„äº‹é …

ä½¿ç”¨ `MiniSearch.loadJSON` æ™‚éœ€ç›´æ¥å‚³å…¥ JSON å­—ç¬¦ä¸²è€Œéè§£æå¾Œçš„å°è±¡ï¼š

```javascript
// éŒ¯èª¤æ–¹å¼
const rawIndex = JSON.parse(text);
const miniSearch = MiniSearch.loadJSON(rawIndex, options);

// æ­£ç¢ºæ–¹å¼
const miniSearch = MiniSearch.loadJSON(text, options);
```

### è·¯ç”±è¨­ç½®æ³¨æ„äº‹é …

é¿å…æœå°‹çµæœè·¯å¾‘èˆ‡ Docusaurus é»˜èªè·¯å¾‘è¡çªï¼š

```javascript
// æ¨è–¦ä½¿ç”¨å°ˆç”¨è·¯å¾‘
searchResultPath = '/search-results'

// ç¢ºä¿ç²¾ç¢ºåŒ¹é…
addRoute({
  path: searchResultPath,
  component: '@theme/SearchResults',
  exact: true,
});
```

## æˆæ¬Šå”è­°

æœ¬å°ˆæ¡ˆä½¿ç”¨ MIT æˆæ¬Šå”è­°ã€‚

## æ–‡æª”é¡å‹

README.md